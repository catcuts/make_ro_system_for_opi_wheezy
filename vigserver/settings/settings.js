/*ã€€China Fujian Huanyutong Technology Co., Ltd. */
const path=require("path"),YAWN=require("yawn-yaml/cjs"),fs=require("fs"),deepExtend=require("deep-extend");Array.prototype.remove=function(e){if("number"==typeof e){if(e<0||e>this.length)throw TypeError;for(let t=0,s=0;t<this.length;t++)this[t]!==this[e]&&(this[s++]=this[t]);this.length-=1}else{"string"==typeof e&&(e=e.indexOf(",")?e.split(","):[e]);let t=this.filter(t=>!e.includes(t));for(let e=0;e<t.length;e++)this[e]=t[e];this.length=t.length}};class SettingsManager{constructor(){this.mode=VIGConsts.RUNMODE,this.filename=path.join(VIGConsts.DataRootFolder,"settings",this.mode+".yaml"),this.json={},this.load()}load(){this._yawn={};try{this._yawn=new YAWN(fs.readFileSync(path.join(__dirname,"default.yaml"),{encoding:"utf8"})),this.json=this._yawn.json}catch(e){console.log(`Error while load default settings file :${e.stack}`)}if(fs.existsSync(this.filename))try{this._yawn=new YAWN(fs.readFileSync(this.filename,{encoding:"utf8"})),deepExtend(this.json,this._yawn.json)}catch(e){console.log(`Error while load settings file ${this.filename}:${e.stack}`)}}save(e){this._yawn.json=e;try{fs.writeFileSync(this.filename,this._yawn.yaml)}catch(e){console.log(`Error while save settings file ${this.filename}:${e.stack}`)}}}let settingsManager=new SettingsManager;global.VIGSettings=settingsManager.json,global.getSettings=function(key,defaultValue=""){try{let expr="VIGSettings"+key.split(".").map(function(e){return"['"+e+"']"}).join(""),result=eval(expr);return void 0===result?defaultValue:result}catch(e){return defaultValue}},module.exports=global.VIGSettings;