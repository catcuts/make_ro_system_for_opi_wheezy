/*ã€€China Fujian Huanyutong Technology Co., Ltd. */
const express=require("express"),ServiceBase=require("../../core/service/servicebase"),ApiAuthMiddleware=require("services/web/security/auth").ApiAuthMiddleware,resources=require("./resources"),APISERVICE_ENTRY_URL="/api";class RESTFulService extends ServiceBase{init(){this.enabledApi=!1,this.loadResources(),this.registerRouters()}loadResources(){this.APIResources=[];for(let e of resources)try{this.APIResources.push(new e)}catch(r){logger.error(_("Error while create api resource {topic} instance : {message} ").params(e.topic,r.stack))}}registerRouters(){this.router=express.Router();for(let e of this.APIResources)try{this.attrs.requireAuth?this.router.use("/"+e.name,ApiAuthMiddleware,e.router):this.router.use("/"+e.name,e.router)}catch(e){logger.error(_("Error while register api router : {message} ").params(e.stack))}VIServer.webserver.router.use(APISERVICE_ENTRY_URL,this.router)}registerResource(e){Array.isArray(e)||(e=[e]);for(let r of e)this.router.use("/"+resource.topic.toLowerCase(),resource.router)}}module.exports=RESTFulService;