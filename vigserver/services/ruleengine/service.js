/*ã€€China Fujian Huanyutong Technology Co., Ltd. */
const ServiceBase=require("core/service/servicebase"),RuleEngine=require("./engine"),Notifys=require("core/eventbus/notifys");class RuleEngineService extends ServiceBase{async init(){this.engine=new RuleEngine}execute(e,t={}){return this.engine.execute(e,t)}async start(){let e=await VIGStorage.openDocument("rules");try{this.engine.loadRules(await e.getAll())}catch(e){logger.error(_("Error while load rules:{e}").params(e.message))}}async stop(){this.engine=null}onNotify(e){e.event===Notifys.HostAttrsChange&&"rules"in e.attrs&&this.restart().then(()=>{logger.debug(_("Restart the rule engine"))}).catch(e=>{logger.debug(_("Error while restarting the rule engine:").params(e.message))})}async getRules(){let e=await VIGStorage.openDocument("rules");return await e.getAll()}}module.exports=RuleEngineService;