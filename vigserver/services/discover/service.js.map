{"version":3,"sources":["0"],"names":["ServiceBase","require","Notifys","deserialize","serialize","AnswerMessage","ErrorMessage","ReportMessage","NoImplementErrorMessage","ParamErrorMessage","MQTT","jsonpath","fs","path","assert","dayjs","asyncSleep","DiscovererBase","[object Object]","service","this","discoverService","endpoint","isModifyNetwork","isUpdateNetwork","defaultNetworkInterface","newNetworkInterface","config","interfaceName","interface","VIGPlatform","network","defaultInterfaceName","disconnect","configure","e","refreshNetwork","Error","_","params","message","default","cfg","dhcp","address","netmask","gateway","currentNetworkConfig","backup","bkfile","join","VIGConsts","Folders","temp","existsSync","unlinkSync","restore","backupNetwork","endTimingReport","restoreNetwork","clearBackupNetwork","_intervalId","clearInterval","setInterval","async","report","settings","reportInterval","hasError","payload","domain","VIGateway","update","vmcService","VIGServices","getServices","transfers","attrs","apply","value","newMqttParams","broker","username","password","Object","assign","answer","to","from","sid","restarting","newCfgs","undefined","ip","subnetmask","dns","restart","applyNetwork","reconnect","VIServer","end","Array","isArray","split","R","pick","options","CloudDiscoverer","super","topics","sn","cloudServer","isConnected","count","interval","ping","isAlive","promise","probe","alive","retry","Promise","resolve","reject","res","isOnline","serverIsOnline","isChangeNetwork","logger","debug","subscribeTopics","then","err","timestamp","valueOf","parseInt","Number","Date","getTime","topic","data","packet","cmd","JSON","stringify","_assertMessageTimeout","String","onBasicConfig","onNetworkConfig","onWifiConfig","onLocationConfig","onReset","onUpgrade","onSetAttrs","onGetAttrs","msg","warn","clientId","type","toLowerCase","wsOptions","keepalive","reschedulePings","protocolId","protocolVersion","clean","reconnectPeriod","connectTimeout","incomingStore","outgoingStore","queueQoSZero","connect","on","onConnected","bind","onError","onMessage","onReconnect","onDisconnected","startTime","checkConnect","setTimeout","connected","checkMqttStatus","unsubscribeTopics","subscribe","qos","reain","authorized","_subscribed","length","unsubscribe","start","detectServer","startTimingReport","stop","retain","publish","error","answerTopic","DiscoverService","inDiscover","info","cloudDiscover","event","HostModeChange","mode","leaveDiscover","node","notify","HostDiscoverMode","discover","enterDiscover","module","exports"],"mappings":"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"}