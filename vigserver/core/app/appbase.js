/*ã€€China Fujian Huanyutong Technology Co., Ltd. */
const path=require("path"),fs=require("fs-extra"),artTemplate=require("art-template"),express=require("express"),{VIGModule:VIGModule}=require("core/vigmodule"),{WebViewBase:WebViewBase}=require("services/web/webview"),{getResourceFromFolder:getResourceFromFolder}=require("services/web/utils");let AppCommonMiddleware=function(e){return(r,t,s)=>{logger.debug("Visit app -> "+e.name+",path= "+r.path),r.currentApp=e,s()}};class AppBase extends VIGModule{constructor(e,r){super(r,{storageName:"apps",moduleType:"app"}),this.devicetypes=[],this.root=path.join(VIGConsts.VIGRootFolder,"apps",this.name.toLowerCase())}getWebsite(){try{return new WebSite(Object.assign({name:this.name,url:this.name.toLowerCase(),middlewares:this.getWebMiddlewares(),apis:this.getWebApis(),views:this.getWebViews(),entry:path.join(this.root,"web"),webroot:path.join(this.root,"web","webroot")},this.attrs.web))}catch(e){logger.error(_("Error while create app<> website : {err}").params(this.name,e.message))}}getWebMiddlewares(){return AppCommonMiddleware(this)}getWebApis(){try{return getResourceFromFolder(path.join(this.root,"web","api"))}catch(e){logger.error(_("Error while get app <{name}> api :{err}").params(this.name,e.message))}}getWebViews(){try{return getResourceFromFolder(path.join(this.root,"web","views"))}catch(e){logger.error(_("Error while get app <{name}> view:{err}").params(this.name,e.message))}}async start(){}async stop(){}}module.exports=AppBase;