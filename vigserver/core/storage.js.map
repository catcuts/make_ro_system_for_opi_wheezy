{"version":3,"sources":["0"],"names":["path","require","fs","assert","Datastore","readYamlFile","async","Documents","name","indexs","unique","StorageLocation","join","VIGConsts","DataRootFolder","diffJsonItems","DocumentRecord","[object Object]","storageName","storagePrimaryKey","this","attrs","pk","Object","assign","force","diffAttrs","updatedNums","R","isEmpty","logger","warn","_","params","firstUpper","JSON","stringify","save","setAttrs","doc","VIGStorage","getDocument","record","findOne","undefined","Error","query","String","options","Promise","resolve","reject","update","$set","err","numAffected","affectedDocuments","upsert","e","error","message","StorageDocument","document","filename","ready","equal","loadDatabase","stack","index","indexName","indexes","reso","reje","ensureIndex","fieldName","sparse","importInitData","compact","assertReady","persistence","compactDatafile","setTimeout","value","multi","returnUpdatedDocs","find","docs","remove","numRemoved","fieldname","indexParams","removeIndex","insert","count","records","sn","VIGPlatform","__host__","waterfall","cb","existsSync","info","__setHostSerialNo","newDocs","length","debug","results","StorageManager","documents","docname","docindex","docobj","open","openDocument","renew","docfile","location","close","unlinkSync","fsExtra","emptySync","docName","getError","init","module","exports"],"mappings":"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"}