/*ã€€China Fujian Huanyutong Technology Co., Ltd. */
const express=require("express"),co=require("co"),isGeneratorFunction=require("../../utils/asyncutil").isGeneratorFunction;class ApiResourceBase{constructor(){this.name="",this.title="",this.description="",this.router=express.Router(),this.settings(),this.router.get("/",this.asyncMethodWrapper(this.get)).get("/:id/",this.asyncMethodWrapper(this.get)).post("/",this.asyncMethodWrapper(this.post)).post("/:id",this.asyncMethodWrapper(this.post)).delete("/",this.asyncMethodWrapper(this.delete)).delete("/:id",this.asyncMethodWrapper(this.delete)).put("/",this.asyncMethodWrapper(this.put)).put("/:id",this.asyncMethodWrapper(this.put)).patch("/:id",this.asyncMethodWrapper(this.put)).head("/:id",this.asyncMethodWrapper(this.head))}settings(){}injectParentResource(e,t,r){let s=new function(){};if("id"in e.params?s.id=e.params.id||"":s.id="",s.name=this.topic,e.parentResource){let t=e.parentResource;e.parentResource=s,e.parentResource.parentResource=t}else e.parentResource=s;r()}registerResource(e,t=!1){t?this.router.use("/:id/"+e.topic,this.asyncMethodWrapper(this.injectParentResource),this.asyncMethodWrapper(e.router)):this.router.use("/"+e.topic,this.asyncMethodWrapper(this.injectParentResource),this.asyncMethodWrapper(e.router))}ResourceQuery(e){let t={};return t="get"==e.method?{id:e.params.id||"",filter:e.query._filter||"",paging:e.query._paging||!1,pageSize:e.query._pageSize||20,pageNum:e.query._pageNum||1,pageCount:e.query._pageCount||1,sortKey:e.query._sortKey||"",sortOrder:e.query._sortOrder||""}:{id:e.params.id||"",filter:e.body._filter||"",paging:e.body._paging||!1,pageSize:e.body._pageSize||20,pageNum:e.body._pageNum||1,pageCount:e.body._pageCount||1,sortKey:e.body._sortKey||"",sortOrder:e.body._sortOrder||""}}asyncMethodWrapper(e){return(t,r,s)=>{if(isGeneratorFunction(e))co(e.call(this,t,r,s)).then(e=>{r.json(e).end()}).catch(e=>{r.json(ErrorApiResponse(e.message)).end()});else try{r.json(e.call(this,t,r,s))}catch(e){r.json(ErrorApiResponse(e.message)).end()}}}*get(e,t,r){return"id"in e.params?this.asyncMethodWrapper(this.one)(e,t,r):this.asyncMethodWrapper(this.list)(e,t,r)}post(e,t,r){return"id"in e.params?this.asyncMethodWrapper(this.create)(e,t,r):this.asyncMethodWrapper(this.batchCreate)(e,t,r)}put(e,t,r){return"id"in e.params?this.asyncMethodWrapper(this.update)(e,t,r):this.asyncMethodWrapper(this.batchUpdate)(e,t,r)}patch(e,t,r){return"id"in e.params?this.asyncMethodWrapper(this.update)(e,t,r):NotSupportedApiResponse()}delete(e,t,r){return"id"in e.params?this.asyncMethodWrapper(this.destroy)(e,t,r):this.asyncMethodWrapper(this.batchDestroy)(e,t,r)}head(e,t,r){return this.asyncMethodWrapper(this.meta)(e,t,r)}list(e,t,r){return NotSupportedApiResponse()}one(e,t,r,s){return NotSupportedApiResponse()}create(e,t,r){return NotSupportedApiResponse()}batchCreate(e,t,r){return NotSupportedApiResponse()}update(e,t,r){return NotSupportedApiResponse()}batchUpdate(e,t,r){}destroy(e,t,r){return NotSupportedApiResponse()}batchDestroy(e,t,r){return NotSupportedApiResponse()}meta(e,t,r){return NotSupportedApiResponse()}toString(){return"ApiResource"}}module.exports={ApiResourceBase:ApiResourceBase};