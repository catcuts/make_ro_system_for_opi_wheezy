{"version":3,"sources":["0"],"names":["express","require","EventBusNode","async","DocumentRecord","Notifys","assert","VIGModuleStatus","Initial","Starting","Runing","Stoping","Stoped","AttrsLoaded","Error","ModuleStatusText","VIGModuleManager","[object Object]","vigserver","this","server","modules","enabledWeb","enabledApi","enabledStatic","urlprefix","staticFolder","moduleType","storageName","doc","VIGStorage","openDocument","find","enabled","e","logger","warn","_","params","message","length","name","module","router","Router","webserver","use","toLowerCase","attrs","_registerRouter","getModules","ordered_modules","Array","sort","a","b","order","moduleSettings","loadModule","Promise","resolve","reject","parallel","map","unloadModule","err","results","instanceOrName","mName","getModuleByName","moduleName","moduleAttrs","getModuleAttrs","debug","_stop","onUnload","R","dropWhile","moduleInst","getModuleClass","VIServer","_initModule","registerModuleRouters","registerModuleApis","registerModuleStaticFolders","push","onLoad","error","stack","firstUpper","middleware","getRouterMiddlewares","viewRouter","restfulService","VIGServices","getServices","getApiMiddlewares","apiRouter","staticfolders","isArray","folder","static","_start","_startModule","moduleInstance","autostart","moduleIsExisted","items","filter","item","join","VIGModule","options","super","Object","assign","storagePrimaryKey","status","statusText","setAttrs","load","restart","connectEventbus","subscribe","vmc","undefined","_vmc","host","VIGateway","equal","canStart","includes","canStop","APIResources","registerStaticFolder","init","node","getEventbusNodeName","context","onMessage","bind","onPulse","onNotify","onError","connect","subscribeMessages","disconnect","title","subjects","split","subject","resources","resource","apiobj","url","view","registerRouter","job","registerJobs","serviceInstance","registerService","msg","broadcastNotify","event","notify","connectToEventbus","_changeStatus","start","onStart","stop","onStop","disconnectFromEventbus","getDefaultAttrs","ModuleAttrsLoaded","exports"],"mappings":"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"}